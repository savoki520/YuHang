<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>常州-宇航</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="lib/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="css/icon/font-awesome.min.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/three-bounce.css">
</head>
<body>
<!--头部-->
<header class="index-header">
    <div class="header-top"></div>
    <div class="header-middle clearfix">
        <div class="logo pull-left">
            <img src="images/index/head-logo.png" alt="">
        </div>
        <div class="content pull-right clearfix">
            <div class="set pull-right dropdown" data-toggle="dropdown" id="get-message">
                <img src="images/engineering/message.png" class="dropdown-toggle"  data-toggle="dropdown" alt="">
                <div class="warning"></div>
                <ul class="dropdown-menu">
                    <li class="menu-header">
                        <span class="active">未读消息</span>
                        <span>历史消息</span>
                        <!--<i class="fa fa-check"></i>-->
                    </li>
                    <li class="menu-body">
                        <ul>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                            <li>
                                <img src="" alt="">
                                张三删除了项目查看/项目001/生产部的XXX文件
                                <span class="time pull-right">18:56</span>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-footer" id="">
                        <img src="images/index/checkbox1.png" alt="">
                        <span>仅看部门相关消息</span>
                    </li>
                </ul>
            </div>
            <div class="set pull-right" id="exit-System">
                <img src="images/index/header-exit.png" alt="">
            </div>
            <div class="set pull-right" id="change_Password">
                <img src="images/index/header-set.png" alt="">
            </div>
            <div class="set pull-right" id="lock-screen">
                <img src="images/index/header-lock.png" alt="">
            </div>
            <div class="line pull-right"></div>
            <div class="box pull-right">
                <img src="images/index/header-time.png" alt="">
                <span id="dataTime">2018年12月26日 星期三</span>
            </div>
            <div class="box pull-right">
                <img src="images/index/header-person.png" alt="">
                <span id="username">张海华，欢迎您</span>
            </div>
        </div>
    </div>
    <div class="header-bottom clearfix">
        <div class="title pull-left">
            项目查看
        </div>
        <div class=" content pull-right clearfix">
            <div class="department pull-right">
                <img src="images/index/work_icon.png" alt="">
                <span>设计部</span>
            </div>
            <div class="search pull-right">
                <input type="text" name="search">
                <img src="images/index/header-search.png" alt="" id="file-search">
            </div>
        </div>
    </div>
</header>
<aside class="index-menu">
    <div class="title">
        <img src="images/menu/menu8.png" alt="">
        <span>个人工作台</span>
    </div>
    <div id="design-menu">
        <div class="menu active">
            <a href="JavaScript:void (0)">
                <img src="images/menu/menu1-1.png" alt="">
                <span>项目查看</span>
            </a>
        </div>
        <div class="menu">
            <a href="pages/Design/ProjectProgress.html">
                <img src="images/menu/menu2.png" alt="">
                <span>项目进度</span>
            </a>
        </div>
        <div class="menu" style="margin-top: 0;">
            <a href="pages/Design/PaymentInspection.html">
                <img src="images/menu/menu3.png" alt="">
                <span>付款及报验</span>
            </a>
        </div>
        <div class="menu" style="margin-top: 0;">
            <a href="pages/Design/CreditDocument.html">
                <img src="images/menu/menu4.png" alt="">
                <span>资信文件</span>
            </a>
        </div>
        <div class="menu" style="margin-top: 0;">
            <a href="pages/Design/ExcellentProject.html">
                <img src="images/menu/menu5.png" alt="">
                <span>优秀项目</span>
            </a>
        </div>
        <div class="menu" style="margin-top: 0;">
            <a href="pages/Design/Reimburse.html">
                <img src="images/menu/menu6.png" alt="">
                <span>报销</span>
            </a>
        </div>
        <div class="menu" style="margin-top: 0;">
            <a href="pages/Design/RecycleBin.html">
                <img src="images/menu/menu7.png" alt="">
                <span>回收站</span>
            </a>
        </div>
    </div>
</aside>
<section class="index-content" style="">
    <div class="title">
        <span>项目编号</span>
        <span id="TimeSorting">时间排序</span>
        <img src="images/design/icon1.png" alt="">
    </div>
    <div class="content clearfix" id="projectContent">

    </div>
    <div class="addNew" id="new-folder">
        <img src="images/design/pic2.png" alt="">
        <span>新建项目</span>
    </div>
</section>
<!--新建项目-->
<div id="new-folder-content">
    <div class="content">
        <p class="title">新建项目</p>
        <div class="input">
            <p>项目名称</p>
            <input type="text" name="folderName">
        </div>
        <div class="input" style="margin-top: 10px;">
            <p>负责人员</p>
            <input type="text" id="author" style="margin-bottom: 0;">
            <div class="warning">（人员姓名用*间隔）</div>
        </div>
        <div>
            <span class="btn btn-default" id="new-folder-cancel">取消</span>
            <span class="btn btn-primary" id="new-folder-ok">确定</span>
        </div>
    </div>
</div>
<!--loading-->
<div class="sk-three-bounce" id="loading">
    <div class="sk-child sk-bounce1"></div>
    <div class="sk-child sk-bounce2"></div>
    <div class="sk-child sk-bounce3"></div>
</div>
<!--重命名-->
<div id="rename-folder" class="add-common-folder">
    <div class="content">
        <p class="title">项目重命名</p>
        <div class="input">
            <p>名称</p>
            <input type="text" name="rename-folder">
        </div>
        <div>
            <span id="rename-folder-C" class="btn btn-default cancel">取消</span>
            <span id="rename-folder-O" class="btn btn-primary ok">确定</span>
        </div>
    </div>
</div>
<!--锁屏-->
<div id="lock-enter">
    <div class="content">
        <p class="title">提示<i class="fa fa-exclamation-circle"></i></p>
        <div class="input">
            <div>
                <img src="images/index/lock-enter.png" alt="">
            </div>
            <div>
                <input type="password" name="lock" class="text-center" placeholder="请输入登录密码">
            </div>
            <div style="margin-top: 60px;">
                <span id="lock-enter-Cancel" class="btn btn-default cancel">重置</span>
                <span id="lock-enter-Ok" class="btn btn-primary ok">确定</span>
            </div>
        </div>
    </div>
</div>
<!--退出系统提示提示-->
<div id="exit-content" class="clear-worning">
    <div class="content">
        <p class="title">
            提示
            <i class="fa fa-exclamation-circle"></i>
        </p>
        <div class="warning text-center" style="font-weight: 700;">
            确认退出系统?
        </div>
        <div class="clear-btn">
            <span id="exit-cancel" class="btn btn-default">取消</span>
            <span id="exit_ok" class="btn btn-primary">确认 </span>
        </div>
    </div>
</div>
<script src="../Tool/js/jquery.min.js"></script>
<script src="lib/bootstrap/bootstrap.min.js"></script>
<script src="lib/slimescroll/jquery.slimscroll.min.js"></script>
<script src="lib/js/toolsFun.js"></script>
<script>
    /*
    * 项目查看
    * author:熊豆豆
    * time:2018-01-14
    * */
    $(function () {
        //内容滚动条
        $('#projectContent').slimScroll({
            width:'100%',
            height: '93%',
            wheelStep: 5,
        });
        $('.menu-body').slimScroll({
            width:'100%',
            height: '400px',
            wheelStep: 5,
            alwaysVisible: true,
        });
       //初始化页面文件
        $('#loading').show();
        var json={
            "filePath":"项目查看",
            "department":0
        };
        http('http://www.youguangchina.cn/YuHang/project/getListFiles','POST',json).done(function (res) {
            var data=res.files;
            for(var i=0;i<data.length;i++){
                $(fold.getNew(data[i].fileName,data[i].filePath,data[i].fileType)).appendTo($("#projectContent"));
                $("div[data-name='"+data[i].fileName+"']").click(function(){
                    fold.getClick(this);
                    event.stopPropagation();
                });
            }
            $('#loading').hide();
        }).fail(function() {
            alert('网络请求错误，请联系管理员！');
        });
    });
    //新建文件夹
    $('#new-folder').on('click',function () {
        $('#new-folder-content').show();
    });
    //确定新建
    $('#new-folder-ok').on('click',function () {
        var name=$("input[name='folderName']").val();
        var author=$('#author').val();
        if(name==""||author==""){
            return;
            alert('数据不能为空！');
        }
        $('#loading').show();
        var data=[];
        var result=author.split("*");
        for(var i=0;i<result.length;i++){
            data.push({"name":result[i]});
        }
        var json={
            "project_name":name,
            "leader":data
        };
        http('http://www.youguangchina.cn/YuHang/project/create','POST',json).done(function (res) {
            $('#loading').hide();
            if(res.result=="success"){
                location.reload();
            }
            else {
                alert(res.error);
            }
            $('#loading').hide();
        }).fail(function() {
            alert('网络请求错误，请联系管理员！');
        });
    });
    //取消新建
    $('#new-folder-cancel').on('click',function () {
        $('#new-folder-content').hide();
    });


    //项目
    var fold={};
    fold.getNew=function($Name,$Path,$Type){
        var folderhtml="<div data-name='"+$Name+"' data-type='"+$Type+"' data-path='"+$Path+"' class=\"folder pull-left\">\n" +
            "            <img src=\"images/design/pic1.png\" alt=\"\">\n" +
            "            <span>"+$Name+"</span><div class=\"menu\">\n" +
            "                <ul><li onclick='Zipdownload(this)'>下载</li><li onclick='Projectdelete(this)'>删除</li><li onclick='ProjectRename()'>重命名</li><li onclick='Cancelmenu()'>取消</li></ul>\n" +
            "            </div>" +
            "        </div>"
        return folderhtml;
    };
    fold.getClick=function(item){
        var $this=$(item);
        var data = {
            fileName:$this.attr('data-name'),
            filePath:$this.attr('data-path')
        };
        console.log(data);
        location.href="pages/Design/ProjectDetails.html"+ params(data);
    };


    //时间排序
    $('#TimeSorting').on('click',function () {
        $('#projectContent').empty();
        var json={
            "filePath":"项目查看",
            "department":0
        };
        $('#loading').show();
        http('http://www.youguangchina.cn/YuHang/project/getListFilesByTime','POST',json).done(function (res) {
            var data=res.files;
            for(var i=0;i<data.length;i++){
                $(fold.getNew(data[i].fileName,data[i].filePath,data[i].fileType)).appendTo($("#projectContent"));
                $("div[data-name='"+data[i].fileName+"']").click(function(){
                    fold.getClick(this);
                    event.stopPropagation();
                });
            }
            $('#loading').hide();
        }).fail(function() {
            alert('网络请求错误，请联系管理员！');
        });
    });




    //项目删除
    function Projectdelete(item) {
        $('#loading').show();
        var json={
            "filePath":$('div.folder.active').attr('data-path'),
            "fileType":$('div.folder.active').attr('data-type')
        };
        http('http://www.youguangchina.cn/YuHang/recycle/addRubbish','POST',json).done(function (res) {
            $('#loading').hide();
            console.log(res);
            if(res=="success"){
                location.reload();
            }
            else {
                alert(res.error);
            }
            $('#loading').hide();
        }).fail(function() {
            alert('网络请求错误，请联系管理员！');
        });
        event.stopPropagation();
    }
    //项目重命名
    function ProjectRename() {
        $('#rename-folder').show();
        $("input[name='rename-folder']").val($('div.folder.active').attr('data-name'));
        event.stopPropagation();
    }
    $('#rename-folder-O').on('click',function () {
        $('#loading').show();
        var json={
            "oriname":$('div.folder.active').attr('data-name'),
            "rename":$("input[name='rename-folder']").val()
        };
        var reg = RegExp(/\/|\\|\:|\?|\*|\"|<|>|\|/);
        if(json.rename.match(reg)){
            alert("含有/\\:?*\"<>|特殊符号，请重新输入");
            return;
        }
        http('http://www.youguangchina.cn/YuHang/project/projectRename','POST',json).done(function (res) {
            $('#loading').hide();
            console.log(res);
            if(res.result=="success"){
                location.reload();
            }
            else {
                alert(res.error);
            }
            $('#loading').hide();
        }).fail(function() {
            alert('网络请求错误，请联系管理员！');
        });
        event.stopPropagation();
    });
    $('#rename-folder-C').on('click',function () {
        $('#rename-folder').hide();
    });
    //项目下载
    function Zipdownload(item) {
        downZipEvent('http://www.youguangchina.cn/YuHang/file/zipdownload',$('div.folder.active').attr('data-path'));
        event.stopPropagation();
    }

    //修改密码
    $('#change-Password1').on('click',function () {
        location.href="pages/login/changePassword.html";
    });


    //搜索功能
    $('#file-search').on('click',function () {
        $('#loading').show();
        var json={
            "filePath": "项目查看",
            "fileName":$("input[name='search']").val()
        };
        $('#projectContent').empty();
        http('http://www.youguangchina.cn/YuHang/project/searchByFileName','POST',json).done(function (res) {
            var data=res.files;
            for(var i=0;i<data.length;i++){
                $(fold.getNew(data[i].fileName,data[i].filePath,data[i].fileType)).appendTo($("#projectContent"));
                $("div[data-name='"+data[i].fileName+"']").click(function(){
                    fold.getClick(this);
                    event.stopPropagation();
                });
            }
            $('#loading').hide();
        }).fail(function() {
            alert('网络请求错误，请联系管理员！');
        });
    });
</script>
</body>
</html>